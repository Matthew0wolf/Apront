# üìã Documenta√ß√£o Completa - Sistema de Rundowns

## üìñ Vis√£o Geral

**Run It Down** √© uma plataforma SaaS para controle de transmiss√µes ao vivo com rundowns automatizados. O sistema permite que equipes de transmiss√£o colaborem em tempo real, gerenciando cronogramas de transmiss√£o com sincroniza√ß√£o autom√°tica entre operadores e apresentadores.

### üéØ Prop√≥sito
- **Operadores**: Controlam o timing e sequ√™ncia dos itens
- **Apresentadores**: Visualizam o conte√∫do atual e pr√≥ximos itens
- **Administradores**: Gerenciam equipes, projetos e configura√ß√µes

---

## üèóÔ∏è Arquitetura T√©cnica

### Backend (Flask/Python)
```
backend/
‚îú‚îÄ‚îÄ app.py                 # Aplica√ß√£o principal Flask
‚îú‚îÄ‚îÄ models.py              # Modelos de dados (SQLAlchemy)
‚îú‚îÄ‚îÄ websocket_server.py    # Servidor WebSocket para tempo real
‚îú‚îÄ‚îÄ auth_utils.py          # Utilit√°rios de autentica√ß√£o
‚îú‚îÄ‚îÄ routes/                # Blueprints das rotas API
‚îÇ   ‚îú‚îÄ‚îÄ auth.py           # Autentica√ß√£o e registro
‚îÇ   ‚îú‚îÄ‚îÄ rundown.py        # CRUD de rundowns
‚îÇ   ‚îú‚îÄ‚îÄ team.py           # Gerenciamento de equipe
‚îÇ   ‚îú‚îÄ‚îÄ admin.py          # Funcionalidades administrativas
‚îÇ   ‚îú‚îÄ‚îÄ plans.py          # Planos e assinaturas SaaS
‚îÇ   ‚îú‚îÄ‚îÄ templates.py      # Marketplace de templates
‚îÇ   ‚îú‚îÄ‚îÄ sync.py           # Sincroniza√ß√£o em tempo real
‚îÇ   ‚îî‚îÄ‚îÄ analytics.py      # Analytics e relat√≥rios
‚îî‚îÄ‚îÄ uploads/              # Arquivos de upload
```

### Frontend (React/Vite)
```
src/
‚îú‚îÄ‚îÄ App.jsx               # Componente principal e roteamento
‚îú‚îÄ‚îÄ components/           # Componentes React
‚îÇ   ‚îú‚îÄ‚îÄ Dashboard.jsx    # Painel principal
‚îÇ   ‚îú‚îÄ‚îÄ ProjectsView.jsx # Gerenciamento de projetos
‚îÇ   ‚îú‚îÄ‚îÄ OperatorView.jsx # Interface do operador
‚îÇ   ‚îú‚îÄ‚îÄ PresenterView.jsx # Interface do apresentador
‚îÇ   ‚îú‚îÄ‚îÄ TeamView.jsx     # Gerenciamento de equipe
‚îÇ   ‚îú‚îÄ‚îÄ PlansView.jsx    # Visualiza√ß√£o de planos
‚îÇ   ‚îî‚îÄ‚îÄ ui/              # Componentes de UI (Radix UI)
‚îú‚îÄ‚îÄ contexts/            # Contextos React
‚îÇ   ‚îú‚îÄ‚îÄ AuthContext.jsx  # Autentica√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ RundownContext.jsx # Estado dos rundowns
‚îÇ   ‚îú‚îÄ‚îÄ SyncContext.jsx  # Sincroniza√ß√£o WebSocket
‚îÇ   ‚îî‚îÄ‚îÄ TimerContext.jsx # Controle de tempo
‚îú‚îÄ‚îÄ pages/               # P√°ginas de autentica√ß√£o
‚îî‚îÄ‚îÄ lib/                 # Utilit√°rios e WebSocket
```

---

## üîê Sistema de Autentica√ß√£o e Autoriza√ß√£o

### Modelos de Usu√°rio
```python
class UserRole(enum.Enum):
    admin = 'admin'           # Acesso total
    operator = 'operator'     # Controla transmiss√µes
    presenter = 'presenter'   # Visualiza conte√∫do

class User(db.Model):
    # Campos b√°sicos
    name, email, password_hash, role, company_id
    
    # Permiss√µes modulares
    can_operate = db.Boolean    # Pode acessar operador
    can_present = db.Boolean    # Pode acessar apresentador
```

### Fluxo de Autentica√ß√£o
1. **Registro**: Email + verifica√ß√£o por token de 6 d√≠gitos
2. **Login**: JWT com 12h de expira√ß√£o
3. **Autoriza√ß√£o**: Baseada em roles e permiss√µes modulares
4. **Middleware**: `@jwt_required()` com verifica√ß√µes de permiss√£o

### Empresas e Multi-tenancy
```python
class Company(db.Model):
    name, domain, plan_id, status, trial_ends_at
    
class Plan(db.Model):
    name, price, max_members, max_rundowns, max_storage_gb, features
```

---

## üìä Modelo de Dados

### Estrutura Principal
```
Company (1) ‚Üê‚Üí (N) User
Company (1) ‚Üê‚Üí (1) Plan
Company (1) ‚Üê‚Üí (N) Subscription
Company (1) ‚Üê‚Üí (N) Rundown

Rundown (1) ‚Üê‚Üí (N) Folder
Folder (1) ‚Üê‚Üí (N) Item
Rundown (N) ‚Üê‚Üí (N) User (RundownMember)
```

### Entidades SaaS
- **Plan**: Define limites e recursos por empresa
- **Subscription**: Gerencia cobran√ßa e status
- **UsageLog**: Rastreia uso para controle de limites
- **CompanyLimits**: Cache de uso atual

### Marketplace
- **Template**: Templates de rundowns reutiliz√°veis
- **TemplateLike**: Sistema de avalia√ß√£o

---

## üîÑ Sincroniza√ß√£o em Tempo Real

### WebSocket Implementation
```python
# Backend (websocket_server.py)
@socketio.on('join_rundown')
def handle_join_rundown(data):
    join_room(f'rundown_{rundown_id}')

@socketio.on('rundown_updated')
def handle_rundown_updated(data):
    emit('rundown_updated', data, room=f'rundown_{rundown_id}')
```

### Eventos Sincronizados
- ‚úÖ **Timer**: Play/pause, tempo atual
- ‚úÖ **Navega√ß√£o**: Item atual, pr√≥ximos itens
- ‚úÖ **Reordena√ß√£o**: Drag & drop de itens/pastas
- ‚úÖ **Estrutura**: Adi√ß√£o/remo√ß√£o de conte√∫do
- ‚úÖ **Status**: Rundown ativo/inativo

### Frontend Sync
```javascript
// SyncContext.jsx
const syncRundownUpdate = (rundownId, changes) => {
  // Evento local imediato
  window.dispatchEvent(new CustomEvent('rundownSync', { detail: { rundownId, changes } }));
  
  // WebSocket para outros clientes
  websocketManager.socket.emit('rundown_updated', { rundown_id: rundownId, changes });
};
```

---

## üéÆ Funcionalidades Atuais

### 1. Dashboard
- ‚úÖ Vis√£o geral de rundowns ativos
- ‚úÖ Estat√≠sticas de equipe
- ‚úÖ Analytics b√°sicos
- ‚úÖ Status de conex√£o WebSocket

### 2. Gerenciamento de Projetos
- ‚úÖ CRUD completo de rundowns
- ‚úÖ Categoriza√ß√£o por tipo
- ‚úÖ Busca e filtros
- ‚úÖ Templates de importa√ß√£o
- ‚úÖ Gerenciamento de equipe por projeto

### 3. Interface do Operador
- ‚úÖ Timer com controle play/pause
- ‚úÖ Navega√ß√£o sequencial de itens
- ‚úÖ Edi√ß√£o em tempo real
- ‚úÖ Drag & drop para reordena√ß√£o
- ‚úÖ Alertas visuais de tempo
- ‚úÖ Sincroniza√ß√£o com apresentador

### 4. Interface do Apresentador
- ‚úÖ Visualiza√ß√£o do item atual
- ‚úÖ Preview dos pr√≥ximos itens
- ‚úÖ Contador de tempo
- ‚úÖ Transi√ß√µes autom√°ticas
- ‚úÖ Modo fullscreen

### 5. Gerenciamento de Equipe
- ‚úÖ Convites por email
- ‚úÖ Controle de permiss√µes granular
- ‚úÖ Roles e permiss√µes modulares
- ‚úÖ Gerenciamento de avatares

### 6. Sistema SaaS
- ‚úÖ Planos com limites
- ‚úÖ Controle de uso
- ‚úÖ Trial period
- ‚úÖ Multi-tenancy por empresa

---

## üìà Estado Atual vs. Potencial SaaS

### ‚úÖ Pontos Fortes Atuais
1. **Arquitetura S√≥lida**: Separa√ß√£o clara frontend/backend
2. **Tempo Real**: WebSocket bem implementado
3. **Multi-tenancy**: Base para SaaS j√° existe
4. **Autentica√ß√£o**: JWT + roles funcionais
5. **UI/UX**: Interface moderna com Radix UI
6. **Permiss√µes**: Sistema granular implementado

### ‚ö†Ô∏è Limita√ß√µes Atuais
1. **Banco de Dados**: SQLite (n√£o escal√°vel)
2. **Pagamentos**: N√£o implementado
3. **Deploy**: Configura√ß√£o local apenas
4. **Monitoramento**: Sem logs/analytics avan√ßados
5. **Backup**: Sem estrat√©gia de backup
6. **Seguran√ßa**: Chaves hardcoded

---

## üöÄ Roadmap para SaaS de Sucesso

### üéØ Fase 1: Infraestrutura (2-4 semanas)

#### 1.1 Banco de Dados
- [ ] **Migra√ß√£o PostgreSQL**
  ```python
  # Substituir SQLite
  DATABASE_URL = os.getenv('DATABASE_URL', 'postgresql://...')
  app.config['SQLALCHEMY_DATABASE_URI'] = DATABASE_URL
  ```

#### 1.2 Vari√°veis de Ambiente
- [ ] **Configura√ß√£o Segura**
  ```python
  # .env
  SECRET_KEY=your_super_secret_key_here
  DATABASE_URL=postgresql://...
  JWT_SECRET=your_jwt_secret
  EMAIL_PASSWORD=your_email_password
  ```

#### 1.3 Docker & Deploy
- [ ] **Containeriza√ß√£o**
  ```dockerfile
  # Dockerfile
  FROM python:3.11-slim
  COPY requirements.txt .
  RUN pip install -r requirements.txt
  ```

#### 1.4 CI/CD Pipeline
- [ ] **GitHub Actions**
  - Testes automatizados
  - Deploy autom√°tico
  - Rollback em caso de erro

### üéØ Fase 2: Monetiza√ß√£o (3-4 semanas)

#### 2.1 Gateway de Pagamento
- [ ] **Stripe Integration**
  ```python
  # routes/payments.py
  @plans_bp.route('/create-subscription', methods=['POST'])
  def create_subscription():
      # Criar subscription no Stripe
      # Ativar plano na empresa
  ```

#### 2.2 Planos Estruturados
```python
PLANS = {
    'starter': {
        'price': 29.90,
        'max_members': 5,
        'max_rundowns': 10,
        'features': ['basic_templates', 'email_support']
    },
    'professional': {
        'price': 99.90,
        'max_members': 20,
        'max_rundowns': 50,
        'features': ['all_templates', 'priority_support', 'analytics']
    },
    'enterprise': {
        'price': 299.90,
        'max_members': 100,
        'max_rundowns': -1,  # Ilimitado
        'features': ['custom_templates', 'dedicated_support', 'sso']
    }
}
```

#### 2.3 Sistema de Cobran√ßa
- [ ] **Billing Engine**
  - Cobran√ßa recorrente
  - Upgrades/downgrades
  - Cancelamentos
  - Notifica√ß√µes de vencimento

#### 2.4 Trial Management
- [ ] **Trial Inteligente**
  - 14 dias gr√°tis
  - Notifica√ß√µes de expira√ß√£o
  - Convers√£o autom√°tica

### üéØ Fase 3: Funcionalidades Avan√ßadas (4-6 semanas)

#### 3.1 Analytics Avan√ßados
- [ ] **Dashboard Executivo**
  ```javascript
  // Analytics detalhados
  - Tempo m√©dio de transmiss√£o
  - Itens mais utilizados
  - Performance da equipe
  - ROI por projeto
  ```

#### 3.2 Integra√ß√µes
- [ ] **APIs Externas**
  - OBS Studio integration
  - YouTube/Twitch API
  - Calendar sync (Google/Outlook)
  - Slack notifications

#### 3.3 Templates Marketplace
- [ ] **Marketplace Completo**
  - Templates pagos
  - Sistema de reviews
  - Categoriza√ß√£o avan√ßada
  - Templates personalizados

#### 3.4 Mobile App
- [ ] **React Native App**
  - Visualiza√ß√£o de rundowns
  - Notifica√ß√µes push
  - Controle b√°sico do timer

### üéØ Fase 4: Escalabilidade (3-4 semanas)

#### 4.1 Performance
- [ ] **Otimiza√ß√µes**
  - Redis para cache
  - CDN para assets
  - Database indexing
  - Query optimization

#### 4.2 Monitoramento
- [ ] **Observabilidade**
  ```python
  # Logging estruturado
  import structlog
  logger = structlog.get_logger()
  ```

#### 4.3 Backup & Recovery
- [ ] **Estrat√©gia de Backup**
  - Backup autom√°tico di√°rio
  - Point-in-time recovery
  - Cross-region replication

#### 4.4 Security
- [ ] **Seguran√ßa Avan√ßada**
  - Rate limiting
  - Input validation
  - SQL injection protection
  - XSS prevention

---

## üí∞ Modelo de Neg√≥cio Recomendado

### üéØ Estrat√©gia de Pre√ßos

#### Plano Starter - R$ 29,90/m√™s
- 5 membros da equipe
- 10 rundowns ativos
- Templates b√°sicos
- Suporte por email

#### Plano Professional - R$ 99,90/m√™s
- 20 membros da equipe
- 50 rundowns ativos
- Todos os templates
- Suporte priorit√°rio
- Analytics avan√ßados

#### Plano Enterprise - R$ 299,90/m√™s
- 100 membros da equipe
- Rundowns ilimitados
- Templates personalizados
- Suporte dedicado
- SSO integration

### üìä Proje√ß√µes de Receita
```
Ano 1: 100 empresas √ó R$ 99,90 √ó 12 = R$ 119.880
Ano 2: 500 empresas √ó R$ 99,90 √ó 12 = R$ 599.400
Ano 3: 1.500 empresas √ó R$ 99,90 √ó 12 = R$ 1.798.200
```

---

## üõ†Ô∏è Implementa√ß√£o T√©cnica Priorit√°ria

### 1. Migra√ß√£o de Banco (Semana 1)
```python
# Alembic migration
from alembic import op
import sqlalchemy as sa

def upgrade():
    # Migrar dados do SQLite para PostgreSQL
    # Criar √≠ndices otimizados
    # Configurar connection pooling
```

### 2. Sistema de Pagamentos (Semana 2-3)
```python
# Stripe webhook handler
@app.route('/webhooks/stripe', methods=['POST'])
def stripe_webhook():
    event = stripe.Webhook.construct_event(
        request.data, request.headers['stripe-signature'], webhook_secret
    )
    
    if event['type'] == 'invoice.payment_succeeded':
        activate_subscription(event['data']['object'])
```

### 3. Deploy Production (Semana 4)
```yaml
# docker-compose.prod.yml
version: '3.8'
services:
  app:
    build: .
    environment:
      - DATABASE_URL=postgresql://...
      - REDIS_URL=redis://...
    depends_on:
      - postgres
      - redis
```

---

## üìã Checklist de Implementa√ß√£o

### ‚úÖ Infraestrutura
- [ ] PostgreSQL setup
- [ ] Redis para cache
- [ ] Docker containerization
- [ ] CI/CD pipeline
- [ ] Environment variables
- [ ] SSL certificates

### ‚úÖ Monetiza√ß√£o
- [ ] Stripe integration
- [ ] Subscription management
- [ ] Billing dashboard
- [ ] Trial system
- [ ] Payment notifications

### ‚úÖ Funcionalidades
- [ ] Advanced analytics
- [ ] Template marketplace
- [ ] API integrations
- [ ] Mobile app
- [ ] SSO support

### ‚úÖ Operacional
- [ ] Monitoring & logging
- [ ] Backup strategy
- [ ] Security hardening
- [ ] Performance optimization
- [ ] Support system

---

## üéØ Conclus√£o

O projeto **Run It Down** possui uma base s√≥lida para se tornar um SaaS de sucesso. A arquitetura atual j√° implementa os fundamentos necess√°rios:

- ‚úÖ Multi-tenancy
- ‚úÖ Autentica√ß√£o robusta
- ‚úÖ Sincroniza√ß√£o em tempo real
- ‚úÖ Interface moderna
- ‚úÖ Sistema de permiss√µes

**Pr√≥ximos passos cr√≠ticos:**
1. **Infraestrutura**: PostgreSQL + Redis + Deploy
2. **Monetiza√ß√£o**: Stripe + Planos estruturados
3. **Escalabilidade**: Performance + Monitoramento

Com as implementa√ß√µes sugeridas, o sistema pode atingir **R$ 1.8M+ em receita anual** no terceiro ano, servindo mais de 1.500 empresas no mercado de transmiss√µes ao vivo.

---

*Documenta√ß√£o gerada em: $(date)*
*Vers√£o: 1.0*
